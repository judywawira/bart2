<html>
  <head>
    <title>Mastercard</title>
    <%= stylesheet_link_tag "mateme" %>
    <%= stylesheet_link_tag fancy_or_high_contrast_touch %>

    <script type="text/javascript">
      var tt_cancel_destination = "/patients/show/?patient_id=" + "<%=@patient_id%>"
      
      var total  = <%="#{session[:mastercard_ids].length.to_i}" rescue 0%>;
      var current = <%="#{session[:mastercard_counter].to_i + 1}" rescue 0%>;
      
      function next(){
        current = current + 1 ;

        if (current >= total){
           current = total;
        }
        document.location = "/patients/mastercard?show_mastercard_counter=true&current=" + current;
      }

      function prev(){
        current = current - 1 ;

        if (current <= 0){
           current = 1;
        }
        document.location = "/patients/mastercard?show_mastercard_counter=true&current=" + current;
      }
    </script>

    <style>
      body {
        background-color: #000;
      }
      #main {
        width: 99.7%;
        height: 88.5%;
        overflow: hidden;
      }

      #content {
        background:#FFFFFF;
        position:absolute;
        left:50%;
        top:50%;
        width:1000px;
        height:750px;
        margin-left:-500px;
        margin-top:-380px;

      }

      #footer {
        background-color:#333333;
        color:#CADCEA;
        height:80px;
        width:100%;
        bottom:0px;
        position:absolute;
        overflow:hidden;
      }

    </style>
  </head>
  <body>
    <div id="content">
      <iframe id="main" style="border: 0px solid #fff;"
              src="/patients/<%= (!@type.nil? ? "general_mastercard" : "mastercard_printable")
                  %>?patient_id=<%=@patient_id%>&type=<%= @type %>"></iframe>

      <div id="footer" style="">
      	<% report_url = "/patients/show/?patient_id=#{@patient_id}" %>
      	
		    <% if @from_report %> 
		    		<% report_url = session[:report_url] %>
		    <% end %>
		    
        <button onclick="window.location ='<%="#{report_url}"%>';" class="button navButton green"
                id="nextButton" style="float: right; margin-right: 10px;" ><span>Finish</span>
        </button>

        <% if @source.nil? %>
          <button class="button navButton blue" style="float: left;"
          	<% if !@show_mastercard_counter %>
                  onmousedown="window.location = '/patients/print_mastercard?patient_id=<%=@patient_id%>'">
            <% else %>
                  onmousedown="window.location = '/patients/print_mastercard?patient_id=<%=@patient_id%>&show_mastercard_counter=true&current=' + current;">            
            <% end %>
            <span>
              Print Mastercard
            </span>
          </button>

          <%if @show_mastercard_counter %>        
                <button id="back" class="<%=@prev_button_class%>" style="position:relative; float:left;" onclick="prev()">
                	<span>Previous</span>
                </button>
                
                <span style="position:relative;float:left; top:-6px; padding : 0px 10px 0 20px">
                	<h1 id="navigation_value"> ----- </h1>
                </span>
                
                <button id="forward" class="<%=@next_button_class%>" style="position:relative; float:left;" onclick="next()">
                	<span>Next</span>
                </button>
          <%end%>
        <% end %>
    
        <% if show_lab_results %>                                     
          <button class="button navButton blue" style="float: left;"
                  onmousedown="window.location = '/lab/results/<%=@patient.id -%>'">
            <span>
              Lab trail
            </span>
          </button>
        <%end%> 

      </div>
    </div>
  </body>
  
	<script>
		try {
			
			document.getElementById('navigation_value').innerHTML = "<input value =" + current + " size='3' maxlength='<%= "#{(session[:mastercard_ids].length.to_s rescue 0).split('').count}" %>' type='text' readonly='readonly' style='font-size:35px; text-align:right;font-weight: bold; padding-right:10px;' />" + " of " + total;
		}
		catch(e) {
			document.getElementById('navigation_value').innerHTML = ''
		}
	</script>
	
</html>
